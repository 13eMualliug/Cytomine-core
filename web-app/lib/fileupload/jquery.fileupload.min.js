(function(h){var c="file_upload",f="undefined",g="function",e="number",a,d,b=function(k,i){var j=0;this.complete=function(){j+=1;if(j===i){k()}}};a=function(A){var y=this,t,l,K={namespace:c,uploadFormFilter:function(Q){return true},fileInputFilter:function(Q){return true},cssClass:c,dragDropSupport:true,dropZone:A,url:function(Q){return Q.attr("action")},method:function(Q){return Q.attr("method")},fieldName:function(Q){return Q.attr("name")},formData:function(Q){return Q.serializeArray()},multipart:true,multiFileRequest:false,withCredentials:false,forceIframeUpload:false},k={},N={},v=/^http(s)?:\/\//,x,w=function(){return typeof XMLHttpRequest!==f&&typeof File!==f&&(!K.multipart||typeof FormData!==f||typeof FileReader!==f)},G=function(){if(K.dragDropSupport){if(typeof K.onDocumentDragEnter===g){k["dragenter."+K.namespace]=function(Q){K.onDocumentDragEnter(Q)}}if(typeof K.onDocumentDragLeave===g){k["dragleave."+K.namespace]=function(Q){K.onDocumentDragLeave(Q)}}k["dragover."+K.namespace]=y.onDocumentDragOver;k["drop."+K.namespace]=y.onDocumentDrop;h(document).bind(k);if(typeof K.onDragEnter===g){N["dragenter."+K.namespace]=function(Q){K.onDragEnter(Q)}}if(typeof K.onDragLeave===g){N["dragleave."+K.namespace]=function(Q){K.onDragLeave(Q)}}N["dragover."+K.namespace]=y.onDragOver;N["drop."+K.namespace]=y.onDrop;K.dropZone.bind(N)}l.bind("change."+K.namespace,y.onChange)},j=function(){h.each(k,function(Q,R){h(document).unbind(Q,R)});h.each(N,function(Q,R){K.dropZone.unbind(Q,R)});l.unbind("change."+K.namespace)},o=function(S,Q,T,R){if(typeof R.onProgress===g){T.upload.onprogress=function(U){R.onProgress(U,S,Q,T,R)}}if(typeof R.onLoad===g){T.onload=function(U){R.onLoad(U,S,Q,T,R)}}if(typeof R.onAbort===g){T.onabort=function(U){R.onAbort(U,S,Q,T,R)}}if(typeof R.onError===g){T.onerror=function(U){R.onError(U,S,Q,T,R)}}},J=function(Q){if(typeof Q.url===g){return Q.url(Q.uploadForm||t)}return Q.url},i=function(Q){if(typeof Q.method===g){return Q.method(Q.uploadForm||t)}return Q.method},u=function(Q){if(typeof Q.fieldName===g){return Q.fieldName(Q.fileInput||l)}return Q.fieldName},F=function(Q){var R;if(typeof Q.formData===g){return Q.formData(Q.uploadForm||t)}else{if(h.isArray(Q.formData)){return Q.formData}else{if(Q.formData){R=[];h.each(Q.formData,function(S,T){R.push({name:S,value:T})});return R}}}return[]},P=function(T){if(v.test(T)){var U=location.host,S=location.protocol.length+2,R=T.indexOf(U,S),Q=R+U.length;if((R===S||R===T.indexOf("@",S)+1)&&(T.length===Q||h.inArray(T.charAt(Q),["/","?","#"])!==-1)){return true}return false}return true},n=function(S,R,Q){if(Q){S.setRequestHeader("X-Requested-With","XMLHttpRequest")}else{if(R.withCredentials){S.withCredentials=true}}if(h.isArray(R.requestHeaders)){h.each(R.requestHeaders,function(T,U){S.setRequestHeader(U.name,U.value)})}else{if(R.requestHeaders){h.each(R.requestHeaders,function(T,U){S.setRequestHeader(T,U)})}}},E=function(R,S,Q){if(Q){S.setRequestHeader("X-File-Name",unescape(encodeURIComponent(R.name)))}S.setRequestHeader("Content-Type",R.type);S.send(R)},q=function(S,U,R){var T=new FormData(),Q;h.each(F(R),function(V,W){T.append(W.name,W.value)});for(Q=0;Q<S.length;Q+=1){T.append(u(R),S[Q])}U.send(T)},s=function(R,S){var Q=new FileReader();Q.onload=function(T){R.content=T.target.result;S()};Q.readAsBinaryString(R)},z=function(W,S,R,Q){var U="--",V="\r\n",T="";h.each(Q,function(X,Y){T+=U+W+V+'Content-Disposition: form-data; name="'+unescape(encodeURIComponent(Y.name))+'"'+V+V+unescape(encodeURIComponent(Y.value))+V});h.each(S,function(X,Y){T+=U+W+V+'Content-Disposition: form-data; name="'+unescape(encodeURIComponent(R))+'"; filename="'+unescape(encodeURIComponent(Y.name))+'"'+V+"Content-Type: "+Y.type+V+V+Y.content+V});T+=U+W+U+V;return T},p=function(T,U,S){var V="----MultiPartFormBoundary"+(new Date()).getTime(),Q,R;U.setRequestHeader("Content-Type","multipart/form-data; boundary="+V);Q=new b(function(){U.sendAsBinary(z(V,T,u(S),F(S)))},T.length);for(R=0;R<T.length;R+=1){s(T[R],Q.complete)}},L=function(W,V,S,X,T){var R=J(T),Q=P(R),U;o(V,S,X,T);X.open(i(T),R,true);n(X,T,Q);if(typeof T.onSend!==g||T.onSend(W,V,S,X,T)!==false){if(!T.multipart){E(V[S],X,Q)}else{if(typeof S===e){U=[V[S]]}else{U=V}if(typeof FormData!==f){q(U,X,T)}else{if(typeof FileReader!==f){p(U,X,T)}else{h.error("Browser does neither support FormData nor FileReader interface")}}}}},M=function(V,U,R,T,S){var W=new XMLHttpRequest(),Q=h.extend({},K);Q.fileInput=R;Q.uploadForm=T;if(typeof Q.initUpload===g){Q.initUpload(V,U,S,W,Q,function(){L(V,U,S,W,Q)})}else{L(V,U,S,W,Q)}},O=function(U,T,Q,S){var R;if(K.multiFileRequest){M(U,T,Q,S)}else{for(R=0;R<T.length;R+=1){M(U,T,Q,S,R)}}},m=function(Q,S,R){var T=F(R);S.find(":input").not(":disabled").attr("disabled",true).addClass(R.namespace+"_disabled");h.each(T,function(U,V){h('<input type="hidden"/>').attr("name",V.name).val(V.value).addClass(R.namespace+"_form_data").appendTo(S)});Q.attr("name",u(R)).appendTo(S)},C=function(Q,S,R){Q.detach();S.find("."+R.namespace+"_disabled").removeAttr("disabled").removeClass(R.namespace+"_disabled");S.find("."+R.namespace+"_form_data").remove()},I=function(R,X,S,V,U){var Y=S.attr("action"),W=S.attr("method"),T=S.attr("target"),Q=R.target.files||[{name:X.val(),type:null,size:null}];V.unbind("abort").bind("abort",function(Z){V.readyState=0;V.unbind("load").attr("src","javascript".concat(":false;"));if(typeof U.onAbort===g){U.onAbort(Z,Q,0,V,U)}}).unbind("load").bind("load",function(Z){V.readyState=4;if(typeof U.onLoad===g){U.onLoad(Z,Q,0,V,U)}h('<iframe src="javascript:false;" style="display:none"></iframe>').appendTo(S).remove()});S.attr("action",J(U)).attr("method",i(U)).attr("target",V.attr("name"));m(X,S,U);if(typeof U.onSend!==g||U.onSend(R,Q,0,V,U)!==false){V.readyState=2;S.get(0).submit()}C(X,S,U);S.attr("action",Y).attr("method",W).attr("target",T)},D=function(U,R,T){var S=h('<iframe src="javascript:false;" style="display:none" name="iframe_'+K.namespace+"_"+(new Date()).getTime()+'"></iframe>'),Q=h.extend({},K);Q.fileInput=R;Q.uploadForm=T;S.readyState=0;S.abort=function(){S.trigger("abort")};S.bind("load",function(){S.unbind("load");if(typeof Q.initUpload===g){Q.initUpload(U,[{name:R.val(),type:null,size:null}],0,S,Q,function(){I(U,R,T,S,Q)})}else{I(U,R,T,S,Q)}}).appendTo(T)},H=function(){t=(A.is("form")?A:A.find("form")).filter(K.uploadFormFilter)},r=function(){l=(t.length?t:A).find("input:file").filter(K.fileInputFilter)},B=function(Q){var R=Q.clone(true);h("<form/>").append(R).get(0).reset();Q.after(R).detach();r()};this.onDocumentDragOver=function(Q){if(typeof K.onDocumentDragOver===g&&K.onDocumentDragOver(Q)===false){return false}Q.preventDefault()};this.onDocumentDrop=function(Q){if(typeof K.onDocumentDrop===g&&K.onDocumentDrop(Q)===false){return false}Q.preventDefault()};this.onDragOver=function(R){if(typeof K.onDragOver===g&&K.onDragOver(R)===false){return false}var Q=R.originalEvent.dataTransfer;if(Q&&Q.files){Q.dropEffect=Q.effectAllowed="copy";R.preventDefault()}};this.onDrop=function(R){if(typeof K.onDrop===g&&K.onDrop(R)===false){return false}var Q=R.originalEvent.dataTransfer;if(Q&&Q.files&&w()){O(R,Q.files)}R.preventDefault()};this.onChange=function(S){if(typeof K.onChange===g&&K.onChange(S)===false){return false}var Q=h(S.target),R=h(S.target.form);if(R.length===1){Q.data(c+"_form",R);B(Q)}else{R=Q.data(c+"_form")}if(!K.forceIframeUpload&&S.target.files&&w()){O(S,S.target.files,Q,R)}else{D(S,Q,R)}};this.init=function(Q){if(Q){h.extend(K,Q);x=Q}H();r();if(A.data(K.namespace)){h.error('FileUpload with namespace "'+K.namespace+'" already assigned to this element');return}A.data(K.namespace,y).addClass(K.cssClass);K.dropZone.not(A).addClass(K.cssClass);G()};this.options=function(S){var U,R,T,Q;if(typeof S===f){return h.extend({},K)}if(x){h.extend(x,S)}j();h.each(S,function(V,W){switch(V){case"namespace":h.error("The FileUpload namespace cannot be updated.");return;case"uploadFormFilter":T=true;Q=true;break;case"fileInputFilter":Q=true;break;case"cssClass":U=K.cssClass;break;case"dropZone":R=K.dropZone;break}K[V]=W});if(T){H()}if(Q){r()}if(typeof U!==f){A.removeClass(U).addClass(K.cssClass);(R?R:K.dropZone).not(A).removeClass(U);K.dropZone.not(A).addClass(K.cssClass)}else{if(R){R.not(A).removeClass(K.cssClass);K.dropZone.not(A).addClass(K.cssClass)}}G()};this.option=function(R,S){var Q;if(typeof S===f){return K[R]}Q={};Q[R]=S;y.options(Q)};this.destroy=function(){j();A.removeData(K.namespace).removeClass(K.cssClass);K.dropZone.not(A).removeClass(K.cssClass)}};d={init:function(i){return this.each(function(){(new a(h(this))).init(i)})},option:function(k,l,j){j=j?j:c;var i=h(this).data(j);if(i){if(typeof k==="string"){return i.option(k,l)}return i.options(k)}else{h.error('No FileUpload with namespace "'+j+'" assigned to this element')}},destroy:function(i){i=i?i:c;return this.each(function(){var j=h(this).data(i);if(j){j.destroy()}else{h.error('No FileUpload with namespace "'+i+'" assigned to this element')}})}};h.fn.fileUpload=function(i){if(d[i]){return d[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof i==="object"||!i){return d.init.apply(this,arguments)}else{h.error("Method "+i+" does not exist on jQuery.fileUpload")}}}}(jQuery));